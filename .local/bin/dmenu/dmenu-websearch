#!/bin/sh

# search websites from dmenu
# default search engine is used if no engine is selected

default_engine="qwant"

add_engine() {
    site_names="${site_names}$1\n"
    eval "$1_engine=\$2"
}

get_url() {
    eval "printf '%s\n' \"\${$1_engine}\""
}

add_engine "google" "https://www.google.com/search?q="
add_engine "archaur" "https://aur.archlinux.org/packages/?O=0&K="
add_engine "archpkg" "https://archlinux.org/packages/?sort=&q="
add_engine "archwiki" "https://wiki.archlinux.org/index.php?search="
add_engine "amazon" "https://www.amazon.com/s?k="
add_engine "arxiv" "https://arxiv.org/search/?searchtype=all&source=header&query="
add_engine "bing" "https://www.bing.com/search?q="
add_engine "duckduckgo" "https://duckduckgo.com/?q="
add_engine "ebay" "https://www.ebay.com/sch/i.html?&_nkw="
add_engine "github" "https://github.com/search?q="
add_engine "gitlab" "https://gitlab.com/search?search="
add_engine "googleimages" "https://www.google.com/search?hl=en&tbm=isch&q="
add_engine "googlenews" "https://news.google.com/search?q="
add_engine "lbry" "https://lbry.tv/$/search?q="
add_engine "odysee" "https://odysee.com/$/search?q="
add_engine "reddit" "https://www.reddit.com/search/?q="
add_engine "socialblade" "https://socialblade.com/youtube/user/"
add_engine "sourceforge" "https://sourceforge.net/directory/?q="
add_engine "stack" "https://stackoverflow.com/search?q="
add_engine "startpage" "https://www.startpage.com/do/dsearch?query="
add_engine "qwant" "https://www.qwant.com/?q="
add_engine "thesaurus" "https://www.thesaurus.com/misspelling?term="
add_engine "translate" "https://translate.google.com/?sl=auto&tl=en&text="
add_engine "wayback" "https://web.archive.org/web/*/"
add_engine "webster" "https://www.merriam-webster.com/dictionary/"
add_engine "wikipedia" "https://en.wikipedia.org/wiki/"
add_engine "wiktionary" "https://en.wiktionary.org/wiki/"
add_engine "wolfram" "https://www.wolframalpha.com/input/?i="
add_engine "youtube" "https://www.youtube.com/results?search_query="

engine=$(printf '%b' "$site_names" | sort | dmenu-wrapper -i -p "Choose engine or search $default_engine:")

if [ -n "$engine" ]; then
    url=$(get_url $engine) # don't quote "" $engine, want to look at first word only ($1)
    if [ -n "$url" ]; then
        query=$(echo | dmenu-wrapper -p "Search $engine:")
        [ -n "$query" ] || url=$(echo "$url" | cut -d '/' -f 1-3)
    else
        url=$(get_url "$default_engine")
        query="$engine"
    fi
    "$BROWSER" --new-window "$url$query"
fi
