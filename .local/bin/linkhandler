#!/bin/sh

# Opens links in appropriate programs
# Useful for newsboat

# Usages:
# -------
# Automatically choose program:
# -- $ linkhandler "link"
# Manually choose program:
# -- $ linkhandler browser "link"

ytdl_format="(bestvideo[height<=?1080]+bestaudio/best)"

cmd_imgviewer() {
    feh "$1"
}

cmd_webbrowser() {
    "$BROWSER" --new-window "$1"
}

cmd_mpv() {
    setsid -f mpv --no-terminal --ytdl-format="$ytdl_format" "$1"
}

cmd_musicplayer() {
    setsid -f "$TERMINAL" -e mpv "$1"
}

cmd_ytdl() {
    yt-dlp -f "$ytdl_format" "$1"
}

case "$1" in
    browser|-b) cmd_webbrowser "$2" ;;
    dl|-d) cmd_ytdl "$2" ;;
    mpv|-m) cmd_mpv "$2" ;;
    *png|*jpg|*gif) cmd_imgviewer "$1" ;;
    *mp3|*wav) cmd_musicplayer "$1" ;;
    *youtube.com/watch*|*.mp4|*.webm|*.mkv) cmd_mpv "$1" ;;
    *) cmd_webbrowser "$1" ;;
esac